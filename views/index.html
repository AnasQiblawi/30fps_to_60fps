<html>

<head>
    <!-- Font Awesome -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet" />
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700&display=swap" rel="stylesheet" />
    <!-- MDB -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/mdb-ui-kit/3.11.0/mdb.min.css" rel="stylesheet" />
    <!-- MDB JS -->
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mdb-ui-kit/3.11.0/mdb.min.js"></script>
    <!-- Jquary CDN -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
</head>

<body>
    <center class="container p-5 text-center w-100">
        <div class="d-grid gap-2 col-6 mx-auto">
            <button id="start" class="btn btn-primary" >Start</button>
            <button id="download" disabled class="btn btn-primary" >Download</button>
            <progress id="ProgressBar" max="100" value="0"></progress>

            <div class="progress" style="height: 20px;">
                <div id="bar2" class="progress-bar bg-info" role="progressbar" style="width: 0%;" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100">0%</div>
            </div>

        </div>
    </center>
</body>


<script>
    // Start
    $("#start").click(function () {
        $.ajax({url:"/start"})
        TimerProgressBar()
    });
    
    // download
    $("#download").click(function () {
        window.open("/download", "_blank")
    });

    // ProgressBar Status interval
    const TimerProgressBar = setInterval(function () { AjaxProgressBar(); }, 1000);

    function AjaxProgressBar() {
        $.ajax({
            url: "/status",
            type: "GET",
            success: function (response, textStatus, jqXHR) {
                // console.log(response);
                
                // Update ProgressBar
                $('#ProgressBar').val(response.ProgressBar)
                $('#bar2').width(`${response.ProgressBar}%`)
                $('#bar2').text(`${response.ProgressBar}%`)

                
                // Stop updater
                // if (response.ProgressBar == 100) { clearTimeout(TimerProgressBar) }; 
                
                if (response.ProgressBar == 100) { 
                    document.getElementById('download').disabled = false
                    // document.getElementById('download').className = "btn btn-success"
                 } else {
                    document.getElementById('download').disabled = true
                 }
                 
            },
            error: function (jqXHR, textStatus, errorThrown) {
                console.log(jqXHR);
                console.log(textStatus);
                console.log(errorThrown);
            }
        });

    };
</script>

</html>